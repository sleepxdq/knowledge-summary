[IOC]

JVM垃圾回收
---

# 回收对象

## 哪些内存需要回收?

Java堆和方法区的对象需要回收。 对于程序计数器、虚拟机栈、本地方法栈这3个区域是线程私有的，他们会随着线程的创建而创建，销毁而销毁。
栈上的栈帧会随着入栈、出栈去消费，栈帧的大小在编译期就已经确定。这几个区域都是确定的，不需要过多的考虑回收的问题，当方法结束或者线程结束时，内存自然就回收了。

对于Java堆和方法区的内存是不确定的，只有在运行期间才知道需要哪些对象，需要多大空间，所以他们是需要被考虑回收的。

## 什么时候回收?
这里要考虑两点，一什么样的对象可以被回收；二什么时候去回收这些可以被回收的对象。

### 什么样的对象可以被回收
不可能被任何用途使用的对象可以被回收。

#### 引用计数法
此算法没有被使用，是初代算法。
简单来说就是对象被引用一次就计数加1，失去引用就减1，当计数为0时，此对象可被回收。

这里会循环依赖的问题，当对象A，B互相引用，但没有其他对象引用A，B，这种就不能被回收，因此就有了可达性算法。

#### 可达性分析算法
现在的垃圾处理器基本都是此算法判断对象是否可被回收。

通过一些定义的"GC Root"对象作为根节点，去找是否有对象被引用，如果没有就是可以被回收的。
##### 哪些对象可以作为GC Root根对象
- 虚拟机栈上引用的对象，就是栈帧中的本地变量表，方法中使用的参数，临时变量，局部变量；
- 方法区的静态类，其实就是被定义成static的参数
- 方法区的常量，就是被定义成常量的对象，声明为final的参数
- native方法中引用的对象
- 基本类型的Class对象，一些异常
- 持有synchronized的对象
- JMX bean注册表中的对象

##### 局部回收是什么策略
// TODO 

## 如何回收?

基于回收算法

### 标记-清除

### 标记-复制算法

### 标记-压缩

## 回收时对程序有什么影响?

程序会暂停

## 多久回收?

根据内存空间的情况

# 分代分区思想

### 分代

### 分区